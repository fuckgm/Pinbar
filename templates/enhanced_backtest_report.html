<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pinbar策略回测报告 - 优化版</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
            color: #333;
        }
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        h1, h2 { 
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
            margin-top: 30px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .info-row {
            text-align: center;
            color: #666;
            margin: 5px 0;
        }
        
        /* === 紧凑型成本分析样式 === */
        .cost-summary {
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
            border: 1px solid #ffa726;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(255, 167, 38, 0.15);
        }
        
        .cost-summary h3 {
            color: #ef6c00;
            margin: 0 0 10px 0;
            border: none;
            font-size: 16px;
            font-weight: bold;
        }
        
        .compact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }
        
        .compact-item {
            background: rgba(255, 255, 255, 0.9);
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            border-left: 3px solid #ffa726;
            transition: transform 0.2s;
        }
        
        .compact-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .compact-value {
            font-size: 14px;
            font-weight: bold;
            color: #ef6c00;
            margin-bottom: 3px;
        }
        
        .compact-label {
            font-size: 10px;
            color: #666;
            text-transform: uppercase;
            line-height: 1.2;
        }
        
        .compact-detail {
            font-size: 9px;
            color: #888;
            margin-top: 2px;
            line-height: 1.1;
        }
        
        /* === 紧凑型保证金分析样式 === */
        .margin-summary {
            background: linear-gradient(135deg, #e8f4fd 0%, #bbdefb 100%);
            border: 1px solid #42a5f5;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(66, 165, 245, 0.15);
        }
        
        .margin-summary h3 {
            color: #1565c0;
            margin: 0 0 10px 0;
            border: none;
            font-size: 16px;
            font-weight: bold;
        }
        
        .margin-item {
            background: rgba(255, 255, 255, 0.9);
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            border-left: 3px solid #42a5f5;
            transition: transform 0.2s;
        }
        
        .margin-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .margin-value {
            font-size: 14px;
            font-weight: bold;
            color: #1565c0;
            margin-bottom: 3px;
        }
        
        .margin-label {
            font-size: 10px;
            color: #666;
            text-transform: uppercase;
            line-height: 1.2;
        }
        
        .margin-detail {
            font-size: 9px;
            color: #1565c0;
            margin-top: 2px;
            line-height: 1.1;
        }
        
        /* 警告信息 */
        .warning-info {
            background: #fff3cd; 
            padding: 8px 12px; 
            margin: 8px 0; 
            border-radius: 4px; 
            border-left: 4px solid #ffc107;
            font-size: 12px;
        }
        
        /* 简化摘要网格样式 */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin: 15px 0;
        }
        
        .summary-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            border-left: 4px solid #4CAF50;
            transition: transform 0.2s;
        }
        
        .summary-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .summary-value {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .summary-label {
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
        }
        
        /* 颜色样式 */
        .positive { color: #4CAF50; }
        .negative { color: #f44336; }
        .warning { color: #ff9800; }
        
        /* 一行显示的核心统计 */
        .core-stats {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            border: 1px solid #ba68c8;
            border-radius: 8px;
            padding: 12px;
            margin: 15px 0;
            text-align: center;
            font-size: 14px;
            color: #6a1b9a;
            font-weight: 500;
        }
        
        .core-stats .stat-item {
            display: inline-block;
            margin: 0 15px;
            padding: 0 10px;
            border-right: 1px solid #ba68c8;
        }
        
        .core-stats .stat-item:last-child {
            border-right: none;
        }
        
        .core-stats .stat-value {
            font-weight: bold;
            font-size: 15px;
        }
        
        /* 交易表格样式 */
        .trades-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 12px;
        }
        .trades-table th {
            background: #4CAF50;
            color: white;
            padding: 8px 4px;
            text-align: center;
            font-weight: normal;
            font-size: 11px;
        }
        .trades-table td {
            padding: 6px 4px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 11px;
        }
        .trades-table tr {
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .trades-table tr:hover {
            background-color: #e3f2fd;
        }
        
        /* 成本明细样式 */
        .cost-detail {
            font-size: 10px;
            color: #666;
            line-height: 1.2;
        }
        
        /* 翻页控件样式 */
        .pagination {
            text-align: center;
            margin: 20px 0;
        }
        .pagination button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            margin: 0 5px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 14px;
        }
        .pagination button:hover {
            background: #45a049;
        }
        .pagination button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .pagination .page-info {
            display: inline-block;
            margin: 0 20px;
            color: #666;
        }
        .pagination select {
            padding: 5px;
            margin: 0 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        
        /* 图表容器 */
        .chart-container {
            margin: 30px 0;
            padding: 20px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }
        
        /* 标签页 */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        .tab:hover {
            background: #f5f5f5;
        }
        .tab.active {
            border-bottom-color: #4CAF50;
            color: #4CAF50;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        /* 交易详情弹窗 */
        .trade-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .trade-modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 1200px;
            max-height: 90%;
            overflow-y: auto;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        /* K线图容器 */
        .kline-chart-container {
            width: 100%;
            height: 500px;
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .trade-detail-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .trade-detail-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .trade-detail-item strong {
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <div class="header">
            <h1>📊 Pinbar策略回测报告 - 优化版</h1>
            <div class="info-row">生成时间: 2024-05-25 14:30:00</div>
            <div class="info-row">交易对: BTCUSDT | 周期: 1h</div>
            <div class="info-row">时间范围: 2024-01-01 ~ 2024-05-01</div>
        </div>
        
        <!-- === 核心统计一行显示 === -->
        <div class="core-stats">
            <div class="stat-item">
                <div class="stat-value">累计成本: 126.57 USDT</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">手续费: 16.59 USDT</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">资金费率: 1.69 USDT</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">滑点: 8.29 USDT</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">成本占比: 8.6%</div>
            </div>
        </div>
        
        <!-- === 紧凑型成本分析区域 === -->
        <div class="cost-summary">
            <h3>💰 交易成本分析</h3>
            <div class="compact-grid">
                <div class="compact-item">
                    <div class="compact-value">16.59 USDT</div>
                    <div class="compact-label">总手续费</div>
                    <div class="compact-detail">平均: 0.83 USDT/笔</div>
                </div>
                <div class="compact-item">
                    <div class="compact-value">1.69 USDT</div>
                    <div class="compact-label">资金费率</div>
                    <div class="compact-detail">平均: 0.08 USDT/笔</div>
                </div>
                <div class="compact-item">
                    <div class="compact-value">8.29 USDT</div>
                    <div class="compact-label">滑点成本</div>
                    <div class="compact-detail">平均: 0.41 USDT/笔</div>
                </div>
                <div class="compact-item">
                    <div class="compact-value">26.57 USDT</div>
                    <div class="compact-label">总成本</div>
                    <div class="compact-detail">占收益: 8.6%</div>
                </div>
                <div class="compact-item">
                    <div class="compact-value">62.4%</div>
                    <div class="compact-label">手续费占比</div>
                </div>
                <div class="compact-item">
                    <div class="compact-value">6.4%</div>
                    <div class="compact-label">资金费率占比</div>
                </div>
            </div>
        </div>
        
        <!-- === 紧凑型保证金使用分析区域 === -->
        <div class="margin-summary">
            <h3>📈 保证金使用分析</h3>
            <div class="warning-info">
                ⚠️ 发现 2 笔交易的保证金数据异常，已排除统计
            </div>
            
            <div class="compact-grid">
                <div class="margin-item">
                    <div class="margin-value">21.1%</div>
                    <div class="margin-label">平均保证金占用</div>
                    <div class="margin-detail">范围: 15.2% - 28.6%</div>
                </div>
                <div class="margin-item">
                    <div class="margin-value">4.7x</div>
                    <div class="margin-label">平均杠杆</div>
                    <div class="margin-detail">最高: 6.6x</div>
                </div>
                <div class="margin-item">
                    <div class="margin-value">168,480</div>
                    <div class="margin-label">总仓位价值 (USDT)</div>
                    <div class="margin-detail">保证金: 35,612 USDT</div>
                </div>
                <div class="margin-item">
                    <div class="margin-value">4.7</div>
                    <div class="margin-label">保证金效率</div>
                    <div class="margin-detail">仓位/保证金比率</div>
                </div>
                <div class="margin-item">
                    <div class="margin-value">
                        盈利: 19.5%<br>亏损: 22.8%
                    </div>
                    <div class="margin-label">交易类型保证金对比</div>
                </div>
                <div class="margin-item">
                    <div class="margin-value">
                        18/20<br>90.0%
                    </div>
                    <div class="margin-label">数据完整度</div>
                </div>
            </div>
        </div>
        
        <!-- 核心指标摘要 - 简化版 -->
        <h2>回测结果摘要</h2>
        
        <!-- 第一行：核心收益指标 -->
        <div class="summary-grid">
            <div class="summary-item">
                <div class="summary-value">10,000 USDT</div>
                <div class="summary-label">初始资金</div>
            </div>
            <div class="summary-item">
                <div class="summary-value">10,308 USDT</div>
                <div class="summary-label">最终资金</div>
            </div>
            <div class="summary-item">
                <div class="summary-value positive">3.08%</div>
                <div class="summary-label">总收益率</div>
            </div>
            <div class="summary-item">
                <div class="summary-value">20</div>
                <div class="summary-label">总交易次数</div>
            </div>
            <div class="summary-item">
                <div class="summary-value positive">65.0%</div>
                <div class="summary-label">胜率</div>
            </div>
        </div>
        
        <!-- 第二行：风险指标 -->
        <div class="summary-grid">
            <div class="summary-item">
                <div class="summary-value positive">1.85</div>
                <div class="summary-label">盈亏比</div>
            </div>
            <div class="summary-item">
                <div class="summary-value negative">-5.2%</div>
                <div class="summary-label">最大回撤</div>
            </div>
            <div class="summary-item">
                <div class="summary-value">0.125</div>
                <div class="summary-label">夏普比率</div>
            </div>
            <div class="summary-item">
                <div class="summary-value">16.8 小时</div>
                <div class="summary-label">平均持仓时间</div>
            </div>
            <div class="summary-item">
                <div class="summary-value">4 / 2</div>
                <div class="summary-label">最大连续盈利/亏损</div>
            </div>
        </div>
        
        <!-- 第三行：信号质量统计 -->
        <div class="summary-grid">
            <div class="summary-item">
                <div class="summary-value">45</div>
                <div class="summary-label">总检测信号数</div>
            </div>
            <div class="summary-item">
                <div class="summary-value">20</div>
                <div class="summary-label">执行信号数</div>
            </div>
            <div class="summary-item">
                <div class="summary-value">44.4%</div>
                <div class="summary-label">信号执行率</div>
            </div>
            <div class="summary-item">
                <div class="summary-value positive">65.0%</div>
                <div class="summary-label">信号成功率</div>
            </div>
            <div class="summary-item">
                <div class="summary-value">3.2/5</div>
                <div class="summary-label">平均信号强度</div>
            </div>
        </div>
        
        <!-- 图表展示 -->
        <div class="tabs">
            <div class="tab active" onclick="showTab('enhanced_price')">价格走势图</div>
            <div class="tab" onclick="showTab('pnl_analysis')">收益分析</div>
        </div>
        
        <div id="enhanced_price" class="tab-content active chart-container">
            <div id="priceChart" style="width:100%;height:400px;border:1px solid #ddd;border-radius:5px;display:flex;align-items:center;justify-content:center;color:#666;">
                📈 价格走势图将在此显示
            </div>
        </div>
        
        <div id="pnl_analysis" class="tab-content chart-container">
            <div id="pnlChart" style="width:100%;height:400px;border:1px solid #ddd;border-radius:5px;display:flex;align-items:center;justify-content:center;color:#666;">
                📊 收益分析图将在此显示
            </div>
        </div>
        
        <!-- === 交易明细表格 - 紧凑版 === -->
        <h2>📊 交易记录明细 (共 20 条)</h2>
        
        <!-- 翻页控件（顶部） -->
        <div class="pagination">
            <button onclick="firstPage()">首页</button>
            <button onclick="prevPage()">上一页</button>
            <span class="page-info">
                第 <span id="currentPage">1</span> 页 / 共 <span id="totalPages">1</span> 页
            </span>
            <button onclick="nextPage()">下一页</button>
            <button onclick="lastPage()">末页</button>
            <span style="margin-left: 20px;">
                每页显示: 
                <select id="pageSize" onchange="changePageSize()">
                    <option value="20" selected>20条</option>
                    <option value="50">50条</option>
                    <option value="100">100条</option>
                </select>
            </span>
        </div>
        
        <table class="trades-table" id="tradesTable">
            <thead>
                <tr>
                    <th>序号</th>
                    <th>方向</th>
                    <th>开仓时间</th>
                    <th>开仓价格</th>
                    <th>平仓时间</th>
                    <th>平仓价格</th>
                    <th>仓位大小</th>
                    <th>杠杆</th>
                    <th>保证金占用</th>
                    <th>手续费</th>
                    <th>资金费率</th>
                    <th>滑点</th>
                    <th>毛利润</th>
                    <th>净收益</th>
                    <th>收益率</th>
                    <th>信号强度</th>
                    <th>平仓原因</th>
                </tr>
            </thead>
            <tbody id="tradesTableBody">
                <!-- 示例数据 -->
                <tr onclick="showTradeDetail(0)" style="cursor: pointer;">
                    <td>1</td>
                    <td><span style="color: green;">做多</span></td>
                    <td style="font-size: 10px;">2024-01-18 00:00</td>
                    <td>2531.2050</td>
                    <td style="font-size: 10px;">2024-01-18 16:00</td>
                    <td>2438.2803</td>
                    <td>3.3375</td>
                    <td>4x</td>
                    <td>
                        <div>2112 USDT</div>
                        <div class="margin-detail">21.1%</div>
                    </td>
                    <td>
                        <div style="color: #d68910; font-weight: bold;">16.59 USDT</div>
                        <div class="cost-detail">开仓+平仓</div>
                    </td>
                    <td>
                        <div style="color: #e67e22; font-weight: bold;">1.69 USDT</div>
                        <div class="cost-detail">持仓期间</div>
                    </td>
                    <td>
                        <div style="color: #8e44ad; font-weight: bold;">8.29 USDT</div>
                        <div class="cost-detail">买卖滑点</div>
                    </td>
                    <td class="negative">-310.14</td>
                    <td class="negative" style="font-weight: bold;">-336.71</td>
                    <td class="negative">-15.94%</td>
                    <td style="color: orange;">3/5</td>
                    <td>止损</td>
                </tr>
            </tbody>
        </table>
        
        <!-- 添加交易详情弹窗 -->
        <div id="tradeModal" class="trade-modal">
            <div class="trade-modal-content">
                <span class="close" onclick="closeTradeDetail()">&times;</span>
                <h2>交易详情</h2>
                <div id="tradeDetailContent"></div>
                <div id="klineChart" class="kline-chart-container"></div>
            </div>
        </div>
    </div>
    
    <script>
        // 示例交易数据
        const allTrades = [
            {
                direction: 'buy',
                entry_time: '2024-01-18 00:00:00',
                entry_price: 2531.2050,
                exit_time: '2024-01-18 16:00:00',
                exit_price: 2438.2803,
                size: 3.3375,
                leverage: 4,
                required_margin: 2112,
                margin_ratio: 21.1,
                commission_costs: 16.59,
                funding_costs: 1.69,
                slippage_costs: 8.29,
                gross_profit: -310.14,
                profit: -336.71,
                profit_pct: -15.94,
                signal_strength: 3,
                reason: '止损'
            }
        ];
        
        let currentPage = 1;
        let pageSize = 20;
        let totalPages = Math.ceil(allTrades.length / pageSize);
        
        function showTradeDetail(tradeIndex) {
            const trade = allTrades[tradeIndex];
            if (!trade) return;
            
            const modal = document.getElementById('tradeModal');
            const content = document.getElementById('tradeDetailContent');
            
            content.innerHTML = `
                <h3>交易 #${tradeIndex + 1} - 详细成本分析</h3>
                <h4>📊 交易区间K线图</h4>
                <div id="tradeKlineChart" style="width: 100%; height: 450px; margin: 20px 0; border: 1px solid #ddd; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #666;">
                    📈 K线图将在此显示 (交易时间段: ${trade.entry_time} ~ ${trade.exit_time})
                </div>
                
                <h4>📋 详细信息表</h4>
                <table style="width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 14px;">
                    <thead>
                        <tr style="background: #f8f9fa;">
                            <th style="padding: 12px; text-align: left; border: 1px solid #dee2e6; background: #e9ecef; font-weight: bold;">类别</th>
                            <th style="padding: 12px; text-align: left; border: 1px solid #dee2e6; background: #e9ecef; font-weight: bold;">项目</th>
                            <th style="padding: 12px; text-align: right; border: 1px solid #dee2e6; background: #e9ecef; font-weight: bold;">数值</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td rowspan="6" style="padding: 12px; border: 1px solid #dee2e6; background: #f8f9fa; font-weight: bold; vertical-align: top;">基础信息</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">方向</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right; font-weight: bold; color: ${trade.direction === 'buy' ? 'green' : 'red'};">${trade.direction === 'buy' ? '🟢 做多' : '🔴 做空'}</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">开仓时间</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right;">${trade.entry_time}</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">开仓价格</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right; font-weight: bold;">${trade.entry_price.toFixed(4)}</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">平仓时间</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right;">${trade.exit_time}</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">平仓价格</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right; font-weight: bold;">${trade.exit_price.toFixed(4)}</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">仓位大小</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right; font-weight: bold;">${trade.size.toFixed(4)}</td>
                        </tr>
                        
                        <tr>
                            <td rowspan="5" style="padding: 12px; border: 1px solid #dee2e6; background: #e3f2fd; font-weight: bold; vertical-align: top;">保证金信息</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">杠杆倍数</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right; font-weight: bold; color: #1976d2;">${trade.leverage}x</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">仓位价值</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right; font-weight: bold;">${(trade.size * trade.entry_price).toFixed(2)} USDT</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">保证金占用</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right; font-weight: bold; color: #1976d2;">${trade.required_margin} USDT</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">保证金比例</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right; font-weight: bold;">${trade.margin_ratio}%</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">保证金回报</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right; font-weight: bold; color: ${trade.profit >= 0 ? 'green' : 'red'};">${((trade.profit / trade.required_margin) * 100).toFixed(1)}%</td>
                        </tr>
                        
                        <tr>
                            <td rowspan="4" style="padding: 12px; border: 1px solid #dee2e6; background: #fff3e0; font-weight: bold; vertical-align: top;">成本明细</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">手续费</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right; font-weight: bold; color: #d68910;">${trade.commission_costs} USDT</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">资金费率</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right; font-weight: bold; color: #e67e22;">${trade.funding_costs} USDT</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">滑点成本</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right; font-weight: bold; color: #8e44ad;">${trade.slippage_costs} USDT</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">总成本</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right; font-weight: bold; color: #d68910; background: #fff8e1;">${(trade.commission_costs + trade.funding_costs + trade.slippage_costs).toFixed(2)} USDT</td>
                        </tr>
                        
                        <tr>
                            <td rowspan="4" style="padding: 12px; border: 1px solid #dee2e6; background: #f3e5f5; font-weight: bold; vertical-align: top;">收益分析</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">毛利润</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right; font-weight: bold; color: ${trade.gross_profit >= 0 ? 'green' : 'red'};">${trade.gross_profit} USDT</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">净利润</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right; font-weight: bold; color: ${trade.profit >= 0 ? 'green' : 'red'}; background: ${trade.profit >= 0 ? '#e8f5e8' : '#ffeaea'};">${trade.profit} USDT</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">收益率</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right; font-weight: bold; color: ${trade.profit_pct >= 0 ? 'green' : 'red'};">${trade.profit_pct}%</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">平仓原因</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; text-align: right; font-weight: bold;">${trade.reason}</td>
                        </tr>
                    </tbody>
                </table>
            `;
            
            // K线图占位
            document.getElementById('klineChart').innerHTML = '<p style="text-align: center; padding: 50px; color: #666;">📈 K线图将在此显示</p>';
            
            modal.style.display = 'block';
        }
        
        function closeTradeDetail() {
            document.getElementById('tradeModal').style.display = 'none';
        }
        
        // 点击弹窗外部关闭
        window.onclick = function(event) {
            const modal = document.getElementById('tradeModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
        
        // 翻页函数
        function updatePagination() {
            totalPages = Math.ceil(Math.max(1, allTrades.length) / pageSize);
            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('totalPages').textContent = totalPages;
        }
        
        function firstPage() {
            currentPage = 1;
            updatePagination();
        }
        
        function lastPage() {
            currentPage = totalPages;
            updatePagination();
        }
        
        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                updatePagination();
            }
        }
        
        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                updatePagination();
            }
        }
        
        function changePageSize() {
            pageSize = parseInt(document.getElementById('pageSize').value);
            currentPage = 1;
            updatePagination();
        }
        
        function showTab(tabName) {
            // 隐藏所有标签页内容
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // 移除所有标签的active类
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // 显示选中的标签页
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        // 初始化
        updatePagination();
    </script>
</body>
</html>